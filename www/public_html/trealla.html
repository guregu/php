<!doctype html>
<html>
<head>
	<title>Trealla Prolog playground</title>
</head>
<body>
<h2>Trealla playground</h2>
<form onsubmit="return ask(), false;">
	<textarea cols=80 rows=20 id="src" placeholder="person(socrates).
mortal(X) :- person(X)."><?=X query_param(src, X) ?></textarea><br>
	<input type="text" style="width: 74ch" placeholder="mortal(Who)." value="<?=X query_param(q, X) ?>" id="query" required>
	<input type="submit" value="Query" id="query-btn" disabled>
</form>

<pre id="result"></pre>

<button onclick="return resetProlog(),false;">Reset Interpreter</button>

<section>
	<h2>more info</h2>
	<ul>
		<li><a href="https://github.com/trealla-prolog/trealla">trealla prolog</a></li>
		<li><a href="https://github.com/guregu/trealla-js">trealla-js</a></li>
	</ul>
</section>

<footer>
powered by <a href="https://github.com/trealla-prolog/trealla">trealla prolog</a>
</footer>

<script>
var QUERY = document.getElementById("query");
var SRC = document.getElementById("src");
var RESULT = document.getElementById("result");
function ask() {
	console.time("query");
	pl.query(QUERY.value, SRC.value).then((result) => {
		console.timeEnd("query");
		RESULT.textContent = JSON.stringify(result, null, "  ");
	});
	updateURL();
}

function updateURL() {
	var url = new URL(document.URL);
	if (SRC.value.length < 10 * 1024) {
		url.searchParams.set("src", SRC.value);
	} else {
		url.searchParams.delete("src");
	}
	url.searchParams.set("q", QUERY.value);
	url.searchParams.set("v", "0");
	history.replaceState(QUERY.value, "", url.toString());
}
</script>
<script type="module">
import { loadFromWAPM, Prolog } from 'https://esm.sh/trealla@0.3.1';

await loadFromWAPM("0.3.1");
window.pl = new Prolog();
window.resetProlog = function() {
	window.pl = new Prolog();
}
document.getElementById("query-btn").removeAttribute("disabled");
</script>
</body>
</html>